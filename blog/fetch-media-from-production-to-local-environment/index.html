<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="Web developer">

        <meta property="og:title" content="Fetch media from production to local environment | Robin Nilsson"/>
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://robin.se/blog/fetch-media-from-production-to-local-environment"/>
        <meta property="og:description" content="Web developer" />

        <title>Fetch media from production to local environment | Robin Nilsson</title>

        <link rel="home" href="https://robin.se">
        <link rel="icon" href="/favicon.ico">
        <link href="/blog/feed.atom" type="application/atom+xml" rel="alternate" title="Robin Nilsson Atom Feed">


            <!-- Global site tag (gtag.js) - Google Analytics -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-D4CS7Z3F5G"></script>
            <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());

                gtag('config', 'G-D4CS7Z3F5G');
            </script>


        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans&family=Montserrat:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Mulish:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,500&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="/assets/build/css/main.css?id=0e6db25c4b0bffda29e7">
    </head>

    <body class="flex flex-col justify-between min-h-screen bg-gray-100 text-gray-800 leading-normal font-sans">
        <header class="flex items-center h-24 py-4" role="banner">
            <div class="container flex items-center max-w-8xl mx-auto px-4 lg:px-8">
                <div class="flex items-center">
                    <a href="/" title="Robin Nilsson home" class="inline-flex items-center">
                        <img class="h-8 md:h-10 mr-3" src="/assets/img/logo.svg" alt="Robin Nilsson logo" />
                    </a>
                </div>

                <div id="vue-search" class="flex flex-1 justify-end items-center">
                    <search></search>

                    <nav class="hidden lg:flex items-center justify-end text-lg">
    <a title="Robin Nilsson Blog" href="/blog"
        class="ml-6 text-gray-900 hover:text-blue-700 ">
        Blog
    </a>

    <a title="Robin Nilsson About" href="/about"
        class="ml-6 text-gray-900 hover:text-blue-700 ">
        About
    </a>

    <a title="Robin Nilsson Projects" href="/projects"
       class="ml-6 text-gray-900 hover:text-blue-700 ">
        Projects
    </a>
</nav>

                    <button class="flex justify-center items-center bg-blue-900 h-10 px-5 rounded-lg lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

                </div>
            </div>
        </header>

        <nav id="js-nav-menu" class="nav-menu hidden lg:hidden">
    <ul class="my-0">
        <li class="pl-4">
            <a
                title="Robin Nilsson Blog"
                href="/blog"
                class="nav-menu__item hover:text-blue-500 "
            >Blog</a>
        </li>
        <li class="pl-4">
            <a
                title="Robin Nilsson About"
                href="/about"
                class="nav-menu__item hover:text-blue-500 "
            >About</a>
        </li>
        <li class="pl-4">
            <a
                title="Robin Nilsson Projects"
                href="/projects"
                class="nav-menu__item hover:text-blue-500 "
            >Projects</a>
        </li>
    </ul>
</nav>

        <main role="main" class="flex-auto w-full container max-w-4xl mx-auto py-16 px-6">
                
    <h1 class="leading-none mb-2">Fetch media from production to local environment</h1>

    <p class="text-gray-700 text-xl md:mt-0">Robin Nilsson  â€¢  August 3, 2018</p>

    
    <div class="border-b border-blue-200 mb-10 pb-4" v-pre>
        <p>Why download images and other heavy resources to your local computer, when you have them available to the public? This does not only save space on your local hard drive. It saves a lot of time syncing resources from production to your local environment.</p>

<p>This snippet first checks if the resource is present in your local space. Its not? 
Then fetch it from the specified production URL. So awesome!</p>

<p>I'm pretty sure this will work for setups that's not using Valet, but I have not tested it outside of Valet.</p>

<p>Your Nginx config file is found in <code>.config/valet/Nginx/yourdomain.test</code> or the old path <code>.valet/Nginx/yourdomain.test</code>.</p>

<p>This file will not be present without running <code>valet secure</code> in your site root. Go ahead and run that if you can't see your domain. If you, like me, don't want to use SSL â€“ just remove the SSL parts from the config and replace port 443 with port 80.</p>

<pre><code class="language-nginx">location ~* .(png|jpe?g|gif|ico|svg)$ {
    expires 24h;
    log_not_found off;
    root '/Users/robin/Sites/robin/public/';

    if (-f $request_filename) {
        break;
    }

    try_files $uri $uri/ @production;
}

location @production {
    resolver 8.8.8.8;
    proxy_pass https://robin.se/$uri;
}
</code></pre>

<p>Don't want to mess with the web server config? Running WordPress? This plugin will do the trick! 
https://wordpress.org/plugins/uploads-by-proxy/</p>

<h2>Bonus</h2>

<p>This works with basically all Nginx configurations, not only Valet â€“ which means you can use it on your Laravel Forge staging server or any other Nginx based web server ðŸ¤Ÿ</p>
    </div>

    <nav class="flex justify-between text-sm md:text-base">
        <div>
                    </div>

        <div>
                            <a href="https://robin.se/blog/pretty-php-dumps-using-highlight_string" title="Newer Post: Pretty PHP dumps using highlight_string()">
                    Pretty PHP dumps using highlight_string() &RightArrow;
                </a>
                    </div>
    </nav>
        </main>

        <footer class="bg-white text-center text-sm mt-12 py-4" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center list-none">
                <li class="md:mr-2">
                    &copy; <a href="https://robin.se" title="Robin website">Robin</a> 2021.
                </li>

                <li>
                    Built with <a href="http://jigsaw.tighten.co" title="Jigsaw by Tighten">Jigsaw</a>
                    and <a href="https://tailwindcss.com" title="Tailwind CSS, a utility-first CSS framework">Tailwind CSS</a>.
                </li>
            </ul>
        </footer>

        <script src="/assets/build/js/main.js?id=66b7da0161ea9e350eb3"></script>

        <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>
    </body>
</html>
